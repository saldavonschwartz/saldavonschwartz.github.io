<!DOCTYPE html>
<!--
	Forty by HTML5 UP
	html5up.net | @ajlkn
	Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
	<title>0XFEDE</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
	<!--[if lte IE 8]><script src="/assets/js/ie/html5shiv.js"></script><![endif]-->
	<link rel="stylesheet" href="/assets/css/main.css" />
	<!--[if lte IE 9]><link rel="stylesheet" href="/assets/css/ie9.css" /><![endif]-->
	<!--[if lte IE 8]><link rel="stylesheet" href="/assets/css/ie8.css" /><![endif]-->
</head>


<body>

    <!-- Wrapper -->
<div id="wrapper">

<!-- Header -->
<header id="header"  class="post" >
	<a href="/" class="logo"><strong>0XFEDE</strong> <span class="logo-sub">Federico Saldarini</span></a>
	<!-- <nav>
		<a class="logo-sub" href="#menu">Menu</a>
	</nav> -->
</header>

<!-- Menu -->
<!-- <nav id="menu">
	<ul class="links">
        
		    
		        <li><a href="/">Home</a></li>
	    	
		
		    
		
		
		    
		
		    
		
	</ul>
	<ul class="actions vertical">
		<li><a href="#" class="button special fit">Get Started</a></li>
		<li><a href="#" class="button fit">Log In</a></li>
	</ul>
</nav> -->



<!-- Main -->
<div id="main" class="alt">

<!-- One -->
<section id="one">
	<div class="inner">
		<header class="major">
      <h1>Warp Fun</h1>
      <h3>Applications of planar homographies</h3>
      
		</header>
    <!--  -->
		<p><!-- Links: -->

<ul>
  <li><strong><a href="#1">About</a></strong></li>
  <li><strong><a href="#2">Finding a Homography between Corresponding Points in two Images</a></strong></li>
  <li><strong><a href="#3">Warping Images</a></strong></li>
  <li><strong><a href="#4">Application: Fake Billboards</a></strong></li>
  <li><strong><a href="#5">Application: Panoramas</a></strong></li>
  <li><strong><a href="#6">Application: Image Recognition</a></strong></li>
</ul>

<h3 id="about"><a class="toc_item" name="1"></a>About:</h3>

<p>Given a set of coplanar points in world space and their projection onto two different 2D image planes (i.e.: as seen by two different cameras or from two different points of view), a 2D planar <strong>homograhpy</strong> is a mapping between these two images of the same points. This mapping is useful in a variety of vision and computational photography tasks involving planes, such as image recognition, image stitching (i.e.: panoramas) and image rectification.</p>

<p><strong>[Figure 1. The homography drawing]</strong></p>

<p>In this project I implemented a general approach to finding homographies between sets of corresponding points in images as well as a few applications of the resulting homographies.</p>

<h3 id="finding-a-homography-between-corresponding-points-in-two-images"><a class="toc_item" name="2"></a>Finding a Homography between Corresponding Points in two Images:</h3>

<p>From Figure 1 and assuming we have two images (a source <script type="math/tex">\mathbf{S}</script> and a target <script type="math/tex">\mathbf{T}</script>) which depict the same world-space coplanar points from different points of view, we wish to find a homography <script type="math/tex">\mathbf{H} \in \mathbb{R}^{3 \times 3}</script> such that we can reproject these points (pixel coordinates) in <script type="math/tex">\mathbf{S}</script> to their counterparts in <script type="math/tex">\mathbf{T}</script>.</p>

<p>Additionally, since the homography operates on projective space:</p>
<ul>
  <li>Source points need to be converted from euclidean to projective space before multiplying them by <script type="math/tex">\mathbf{H}</script>.</li>
  <li>The resulting target points need to be converted from projective to euclidean space in order to obtain their final 2D coordinates.</li>
</ul>

<p>So we want <script type="math/tex">\mathbf{H}</script> such that given source pixel locations <script type="math/tex">\mathbf{s}^{(i)}</script> and target pixel locations <script type="math/tex">\mathbf{t}^{(i)}</script>:</p>

<script type="math/tex; mode=display">\bar{\mathbf{t}}^{(i)} = \mathbf{H} \hat{\mathbf{s}}^{(i)}\text{, where:}\\
\hat{\mathbf{s}}^{(i)} = \begin{bmatrix}s_x\\s_y\\1\end{bmatrix},\ \bar{\mathbf{t}}^{(i)} = \begin{bmatrix}\bar{t_x}\\\bar{t_y}\\\bar{t_w}\end{bmatrix},\ \mathbf{t}^{(i)} = \begin{bmatrix}\frac{\bar{t_x}}{\bar{t_w}}\\\frac{\bar{t_y}}{\bar{t_w}}\end{bmatrix}</script>

<p>Which can be expressed as a system of linear equations <script type="math/tex">\mathbf{A}\mathbf{h} = \mathbf{b}</script>. In this system <script type="math/tex">\mathbf{h} \in \mathbb{R}^9</script> is the flattened homography matrix and <script type="math/tex">\mathbf{A} \in \mathbb{R}^{n \times 9}: n >= 9</script> represents x and y-constraints (one per pixel coordinate; at least 4 pixel coordinates) plus a constant scale constraint which makes the system inhomogeneous and solvable via linear least squares.</p>

<p>The constraints are as follow:</p>

<ul>
  <li>
    <p><strong>x:</strong> <script type="math/tex">% <![CDATA[
t_x\bar{t_w} - \bar{t_x} = 0 \Rightarrow\\
\begin{align}&t_x(h_{31}s_x + h_{32}s_y + h_{33}) - h_{11}s_x - h_{12}s_y - h_{13} = 0\\
&\begin{bmatrix}-s_x&-s_y&-1&0&0&0&t_x s_x&t_x s_y&t_x\end{bmatrix}^T\\
&{\mathbf{a}_x^{(i)}}^T \mathbf{h} = 0
\end{align} %]]></script></p>
  </li>
  <li>
    <p><strong>y:</strong> <script type="math/tex">% <![CDATA[
t_y\bar{t_w} - \bar{t_y} = 0 \Rightarrow\\
\begin{align}&t_y(h_{31}s_x + h_{32}s_y + h_{33}) - h_{21}s_x - h_{22}s_y - h_{23} = 0\\
&\begin{bmatrix}0&0&0&-s_x&-s_y&-1&t_y s_x&t_y s_y&t_y\end{bmatrix}^T\\
&{\mathbf{a}_y^{(i)}}^T \mathbf{h} = 0
\end{align} %]]></script></p>
  </li>
  <li>
    <p><strong>scale:</strong> <script type="math/tex">% <![CDATA[
\lVert\mathbf{H}\rVert_F = 1 \Rightarrow\\
\begin{align}
&\begin{bmatrix}0&0&0&0&0&0&0&0&1\end{bmatrix}^T\\
&\mathbf{a}_k^T \mathbf{h} = 1
\end{align} %]]></script></p>
  </li>
</ul>

<p>From these constraints the system can be put together as:</p>

<script type="math/tex; mode=display">\begin{bmatrix}{\mathbf{a}_x^{(1)}}^T\\{\mathbf{a}_y^{(1)}}^T\\\vdots\\{\mathbf{a}_x^{(4)}}^T\\{\mathbf{a}_y^{(4)}}^T\\\vdots\\{\mathbf{a}_x^{(n-1)}}^T\\{\mathbf{a}_y^{(n-1)}}^T\\\mathbf{a}_k^T\end{bmatrix} \begin{bmatrix}h_{11}\\h_{12}\\h_{13}\\h_{21}\\h_{22}\\h_{23}\\h_{31}\\h_{32}\\h_{33}\end{bmatrix} = \begin{bmatrix}0\\\vdots\\1\end{bmatrix}</script>

<p>And the solution to <script type="math/tex">\text{min}_\mathbf{h}\ \lVert\mathbf{A}\mathbf{h} - \mathbf{b}\rVert^2_2 = (\mathbf{A}^T \mathbf{A})^{-1} \mathbf{A}^T \mathbf{b}</script> will be <script type="math/tex">\mathbf{H}</script>. Also, since 2D planar homographies are invertible, we have <script type="math/tex">\mathbf{H}_{S2T}^{-1} = \mathbf{H}_{T2S}</script> which means that having computed the homography in one direction, we can invert it to reproject in the other direction.</p>

<h3 id="warping-images"><a class="toc_item" name="3"></a>Warping Images:</h3>

<p>Once a homography between source and target coordinates is computed, the whole source image can be warped by reprojecting all its pixel coordinates onto the target imageâ€™s space. This is referred to as <strong>forward</strong> warping.</p>

<p>One issue with forward warping is that integer pixel coordinates in the source will likely map to subpixel coordinates in the target, requiring some interpolation scheme to figure out the values of a number of neighboring target pixels for the result to look acceptable. The alternative, known as <strong>inverse</strong> warping, instead uses the inverse of <script type="math/tex">\mathbf{H}_{S2T} = \mathbf{H}_{T2S}</script> so that the problem is reformulated as:</p>

<script type="math/tex; mode=display">% <![CDATA[
\begin{align}
\text{for}\ &\text{each pixel location}\ \mathbf{t}^{(i)} \in \mathbf{T}:\\
&\hat{\mathbf{t}}^{(i)} = \mathbb{R}2\mathbb{P}(\mathbf{t}^{(i)})\\
&\bar{\mathbf{s}}^{(i)} = \mathbf{H}_{T2S} \hat{\mathbf{t}}^{(i)}\\
&\mathbf{s}^{(i)} = \mathbb{P}2\mathbb{R}(\bar{\mathbf{s}}^{(i)})\\
&\mathbf{T}[\mathbf{t}^{(i)}] = \text{interpolate}(\mathbf{S}, \mathbf{s}^{(i)})
\end{align} %]]></script>

<p>Which is easier to approach since it requires computing a single interpolated value given a subpixel lookup in the source. The applications in this project use inverse warping with bilinear interpolation other than to figure out the sizes of final images.</p>

<h3 id="application-fake-billboards"><a class="toc_item" name="4"></a>Application: Fake Billboards:</h3>

<p>This application reprojects a frontal image <script type="math/tex">\mathbf{S}</script> onto several locations in an image <script type="math/tex">\mathbf{T}</script>, as if <script type="math/tex">\mathbf{S}</script></p>

<h3 id="application-panoramas"><a class="toc_item" name="5"></a>Application: Panoramas:</h3>
<p>TODO</p>
<h3 id="application-image-recognition"><a class="toc_item" name="6"></a>Application: Image Recognition:</h3>
<p>TODO</p>
</p>
	</div>
</section>

</div>

    <!-- Footer -->
	<footer id="footer">
		<div class="inner">
			<ul class="icons">
				
				
				
				
				
				
				
				
				<li><a href="https://github.com/saldavonschwartz" class="icon alt fa-github" target="_blank"><span class="label">GitHub</span></a></li>
				
				
				
				<li><a href="https://www.linkedin.com/in/federicosaldarini" class="icon alt fa-linkedin" target="_blank"><span class="label">LinkedIn</span></a></li>
				
			</ul>
			<ul class="copyright">
				<li>&copy; 2018 Federico Saldarini. All rights reserved.</li>
				<li>Based on Forty theme by <a href="https://html5up.net" target="_blank">HTML5 UP</a></li>
			</ul>
		</div>
	</footer>

</div>

<!-- Scripts -->
	<script src="/assets/js/jquery.min.js"></script>
	<script src="/assets/js/jquery.scrolly.min.js"></script>
	<script src="/assets/js/jquery.scrollex.min.js"></script>
	<script src="/assets/js/skel.min.js"></script>
	<script src="/assets/js/util.js"></script>
	<script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script> -->
	<!--[if lte IE 8]><script src="/assets/js/ie/respond.min.js"></script><![endif]-->
	<script src="/assets/js/main.js"></script>


</body>

</html>
